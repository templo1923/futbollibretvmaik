<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Reproductor | Fútbol Libre TV</title>
    <link rel="icon" href="faviconnuevo.png" type="image/png" />
    <!-- Reproductor de Video Clappr -->
    <script src="//cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <!-- Plugin para reproducir streams HLS (.m3u8) -->
    <script src="//cdn.jsdelivr.net/npm/clappr-hlsjs-plugin@latest/dist/hlsjs-playback.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #loading { color: white; text-align: center; padding-top: 40vh; font-family: sans-serif; position: absolute; width: 100%; z-index: 10; }
    </style>
</head>
<body>
    <div id="player"></div>
    <div id="loading">Cargando canal, por favor espera...</div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const streamName = urlParams.get('stream');
        const loadingElement = document.getElementById('loading');
        
        if (streamName) {
            // Llama a nuestro propio servidor (que está en la carpeta /api)
            const apiUrl = `/api/canal?stream=${streamName}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error(`Error del servidor: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    if (data.success && data.url) {
                        loadingElement.style.display = 'none';
                        // Inicia el reproductor con la URL limpia que nos dio el servidor
                        new Clappr.Player({
                            source: data.url,
                            parentId: "#player",
                            width: "100%", 
                            height: "100%",
                            autoPlay: true,
                            mediacontrol: { seekbar: "#15803d", buttons: "#FFFFFF" }
                        });
                    } else {
                        loadingElement.innerText = `Error: ${data.error || 'No se recibió una URL válida.'}`;
                    }
                })
                .catch(error => {
                    console.error("Error en el fetch:", error);
                    loadingElement.innerText = `No se pudo cargar el canal. Es posible que la transmisión no esté disponible.`;
                });
        } else {
            loadingElement.innerText = 'Error: No se ha especificado un stream para reproducir.';
        }
    </script>
</body>
</html>

